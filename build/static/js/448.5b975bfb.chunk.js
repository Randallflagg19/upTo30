"use strict";(self.webpackChunkupto30=self.webpackChunkupto30||[]).push([[448],{4448:(e,t,s)=>{s.r(t),s.d(t,{AuthMessageContext:()=>W,UserContext:()=>E,default:()=>F});var a=s(5043),n=s(3216);const o="Login_authWrapper__4Jl87",r="Login_loginButton__9LLct",i="Login_authMessage__oV8uN";const l=new class{constructor(e){this.url=void 0,this.registration=async(e,t)=>{try{return(await fetch(`${this.url}/registation`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:e,password:t})})).ok}catch(s){return!1}},this.fetchAllWords=async()=>{try{if(!localStorage.getItem("TheToken"))throw new Error("No token found");const e=await fetch(`${this.url}/translator/get`,{method:"GET",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("TheToken")||""}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return t.map((e=>({id:e.id,word:e.en,translation:e.ru})))}catch(e){return console.error("Failed to fetch words:",e),[]}},this.fetchGuestWords=async()=>{try{const e=await fetch(`${this.url}/translator/guest/get`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return t.map((e=>({id:e.id,word:e.en,translation:e.ru})))}catch(e){return console.error("Failed to fetch words:",e),[]}},this.sendWords=async(e,t)=>{const s=await fetch(`${this.url}/translator/write`,{method:"PUT",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("TheToken")||""},body:JSON.stringify({en:e,ru:t})});if(!s.ok)throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440");return await s.json()},this.login=async(e,t)=>{try{const s=await fetch(`${this.url}/login`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:e,password:t})});if(!s.ok)throw new Error("Invalid login or password");return await s.json()}catch(s){throw new Error("Invalid login or password")}},this.delete=async e=>{try{await fetch(`${this.url}/translator/delete`,{method:"DELETE",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("TheToken")||""},body:JSON.stringify({id:e})})}catch(t){throw new Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u0441\u043b\u043e\u0432\u0430 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430")}},this.url=e}}("https://gustaw.ru/api");var c=s(579);function d(){const{setIsLoggedIn:e,setIsGuest:t}=(0,a.useContext)(E),[s,d]=(0,a.useState)("test"),[u,h]=(0,a.useState)("test"),p=(0,n.Zp)(),{authMessage:g,setAuthMessage:m}=(0,a.useContext)(W),w=e=>{"login"===e&&"test"===s?d(""):"password"===e&&"test"===u&&h("")};return(0,c.jsxs)("div",{className:o,children:[(0,c.jsx)("h1",{className:i,children:g}),(0,c.jsx)("input",{type:"text",onFocus:()=>w("login"),onChange:e=>d(e.target.value),value:s}),(0,c.jsx)("input",{type:"password",onFocus:()=>w("password"),onChange:e=>h(e.target.value),value:u}),(0,c.jsx)("button",{className:r,onClick:async()=>{try{let t=await l.login(s,u);localStorage.setItem("TheToken",t.token),e(!0),setTimeout((()=>p("/translator/main")),500),m("\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c"),setTimeout((()=>m("\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f")),500)}catch(t){e(!1),m("\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c")}},children:"Login"}),(0,c.jsx)("button",{className:r,onClick:()=>{localStorage.setItem("isGuest","true"),t(!0),e(!1),p("/translator/main")},children:"\u0412\u043e\u0439\u0442\u0438 \u043a\u0430\u043a \u0433\u043e\u0441\u0442\u044c"}),(0,c.jsx)("button",{className:r,onClick:async()=>{try{let e=await l.registration(s,u);m(e?"\u0412\u044b \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b":"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d")}catch(e){m("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438")}},children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]})}const u="PostItem_imageButton__541UL",h="PostItem_post__A2gF3",p=e=>{let{post:t,onDelete:s}=e;const{isLoggedIn:n}=(0,a.useContext)(E);return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{className:h,children:[(0,c.jsxs)("strong",{children:[t.word," - ",t.translation]}),n&&(0,c.jsx)("button",{className:u,onClick:async()=>{if(window.confirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0441\u043b\u043e\u0432\u043e?")){const a=t.id;try{await l.delete(a),console.log(`Word with id ${a} has been deleted.`),s(a)}catch(e){console.error(`Error deleting word with id ${a}:`,e)}}}})]})})};var g=s(3516),m=s(899);const w={wrapper:"Inputs_wrapper__DZ-5t",errorInput:"Inputs_errorInput__0FdN5",inputWrapper:"Inputs_inputWrapper__9fguB",globalInput:"Inputs_globalInput__kaK1X",add:"Inputs_add__WL5TP",gap:"Inputs_gap__-Z4As"},_=e=>{let{onAdd:t}=e;const s=(0,a.useRef)(null),{isLoggedIn:n}=(0,a.useContext)(E),o=m.Ik({word:m.Yj().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435"),translation:m.Yj().required("\u041e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u043f\u043e\u043b\u0435")});return(0,c.jsx)("div",{children:n&&(0,c.jsx)(g.l1,{initialValues:{word:"",translation:""},validationSchema:o,onSubmit:(e,a)=>{var n;let{resetForm:o}=a;t(e.word,e.translation),o(),null===(n=s.current)||void 0===n||n.focus()},children:()=>(0,c.jsx)(g.lV,{className:w.wrapper,children:(0,c.jsxs)("div",{className:w.inputWrapper,children:[(0,c.jsx)(g.D0,{name:"word",placeholder:"word",className:w.globalInput,innerRef:s,autoComplete:"off"}),(0,c.jsx)(g.Kw,{name:"word",component:"div",className:w.error}),(0,c.jsx)("div",{className:w.gap}),(0,c.jsx)(g.D0,{name:"translation",placeholder:"\u043f\u0435\u0440\u0435\u0432\u043e\u0434",className:w.globalInput,autoComplete:"off"}),(0,c.jsx)(g.Kw,{name:"translation",component:"div",className:w.error}),(0,c.jsx)("button",{className:w.add,type:"submit",children:"add"})]})})})})},x="Pagination_pagination__YC04s",j="Pagination_selectedPage__WTw9F",f="Pagination_prev__hcPBu",C="Pagination_next__tgJkT",y=e=>{let{currentPage:t,setCurrentPage:s,postsCount:n,wordsOnPage:o}=e;const r=Math.ceil(n/o),i=Math.ceil(r/10),l=Math.ceil(t/10),d=10*(l-1)+1,u=Math.min(10*l,r),h=(0,a.useMemo)((()=>{const e=[];for(let a=d;a<=u;a++)e.push((0,c.jsx)("button",{onClick:()=>s(a),className:t===a?j:void 0,children:a},a));return e}),[d,u,t,s]);return(0,c.jsxs)("span",{className:x,children:[l>1&&(0,c.jsx)("button",{className:f,onClick:()=>s(t-1),children:"Prev"}),h,l<i&&(0,c.jsx)("button",{className:C,onClick:()=>s(t+1),children:"Next"})]})};function I(e){const[t,s]=(0,a.useState)([]),[n,o]=(0,a.useState)("");(0,a.useEffect)((()=>{(async()=>{try{if(localStorage.getItem("TheToken")){e(!0);const t=await l.fetchAllWords();s(t)}else{const e=await l.fetchGuestWords();s(e)}}catch(t){console.error("Failed to fetch words:",t)}})()}),[e]);return{posts:t.filter((e=>e.word.toLowerCase().includes(n))),handleDeletePost:e=>{s((t=>t.filter((t=>t.id!==e))))},handleSearchChange:e=>{o(e.target.value.toLowerCase())},addNewPost:async(e,t)=>{try{const a={id:(await l.sendWords(e,t)).id,word:e,translation:t};s((e=>[a,...e]))}catch(a){console.error("Failed to add new word:",a)}},arrange:()=>{s((e=>[...e].sort(((e,t)=>e.word.localeCompare(t.word)))))},filterMatch:()=>{const e={},a=[];t.forEach((t=>{const s=t.word.toLowerCase();e[s]=(e[s]||0)+1})),t.forEach((t=>{const s=t.word.toLowerCase();e[s]>1&&a.push(t)})),s(a)},searchValue:n}}const k="Main_mainHeader__uiodj",N="Main_search__F-6Gm",T="Main_exit__pY60W",v="Main_authLink__n5wn0",b="Main_arrange__SPwoh",S="Main_match__2odUd";var P=s(5475);const M=()=>{const e=(0,a.useContext)(E),{isLoggedIn:t,setIsGuest:s,setIsLoggedIn:o,isGuest:r}=e,{posts:i,handleDeletePost:l,filterMatch:d,handleSearchChange:u,addNewPost:h,arrange:g}=I(o),m=(0,n.Zp)(),[w,x]=(0,a.useState)(1),j=(0,a.useMemo)((()=>i.slice(20*(w-1),20*w)),[i,w]),f=(0,a.useMemo)((()=>j.map((e=>(0,c.jsx)(p,{post:e,onDelete:l},e.id)))),[j,l]),C=(0,a.useCallback)((()=>{localStorage.removeItem("TheToken"),o(!1),s(!1),localStorage.setItem("isGuest","false"),m("/translator")}),[o,s,m]);(0,a.useCallback)((()=>{d(),x(1)}),[d]);return t||r?(0,c.jsxs)("div",{children:[(0,c.jsxs)("header",{className:k,children:[(0,c.jsx)("button",{className:T,onClick:C,children:"Exit"}),(0,c.jsx)("button",{className:S,onClick:d,children:"match"}),(0,c.jsx)("button",{className:b,onClick:g,children:"sort"}),(0,c.jsx)("form",{className:N,children:(0,c.jsxs)("label",{children:["Search:",(0,c.jsx)("input",{type:"search",onChange:u})]})})]}),(0,c.jsx)(_,{onAdd:h}),(0,c.jsx)(y,{currentPage:w,setCurrentPage:x,postsCount:i.length,wordsOnPage:20}),(0,c.jsx)("div",{children:f})]}):(0,c.jsx)(P.N_,{className:v,to:"/",children:"\u0410\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f"})},L=[{path:"/",component:(0,c.jsx)(d,{}),label:"\u041b\u043e\u0433\u0438\u043d"},{path:"main",component:(0,c.jsx)(M,{}),label:"Main"},{path:"*",component:(0,c.jsx)("h1",{children:"\u0441\u0442\u0440\u0430\u043d\u0438\u0447\u043a\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430"}),label:"Not found"}],E=a.createContext(null),W=a.createContext(null);const F=function(){const[e,t]=(0,a.useState)(!1),[s,o]=(0,a.useState)(!1),[r,i]=(0,a.useState)("\u0422\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u044f");return(0,c.jsx)(E.Provider,{value:{isLoggedIn:e,setIsLoggedIn:t,isGuest:s,setIsGuest:o},children:(0,c.jsx)(W.Provider,{value:{authMessage:r,setAuthMessage:i},children:(0,c.jsx)(n.BV,{children:L.map((e=>(0,c.jsx)(n.qh,{path:e.path,element:e.component},e.path)))})})})}}}]);
//# sourceMappingURL=448.5b975bfb.chunk.js.map